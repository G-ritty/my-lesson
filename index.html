<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ğŸ¨ å°å°æ•°å­—è®¾è®¡å¸ˆ Â· ç”µå­è´ºå¡é—¯å…³</title>

<link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{
  font-family:"ZCOOL KuaiLe";
  background: linear-gradient(#cceeff,#ffffff);
  margin:0;
  padding:20px;
}
h1{text-align:center;color:#ff6b6b;}

.card{
  background:white;
  border-radius:25px;
  padding:20px;
  margin:20px auto;
  max-width:900px;
  box-shadow:0 8px 16px rgba(0,0,0,.12);
  border-left:12px solid #74c0fc;
}
textarea,input{
  width:100%;
  border-radius:15px;
  padding:12px;
  border:2px dashed #74c0fc;
  font-size:16px;
}
button{
  background:#4dabf7;
  color:white;
  border:none;
  border-radius:30px;
  padding:12px 24px;
  font-size:18px;
  cursor:pointer;
}
button:hover{background:#339af0;}

.preview img{
  max-width:120px;
  border-radius:15px;
  margin:5px;
}

/* èŠå¤© */
#botBtn{
  position:fixed;
  right:20px;
  bottom:20px;
  width:70px;height:70px;
  background:#ffd43b;
  border-radius:50%;
  font-size:36px;
  text-align:center;
  line-height:70px;
  cursor:pointer;
}
#chatBox{
  display:none;
  position:fixed;
  right:20px;
  bottom:100px;
  width:320px;
  height:420px;
  background:white;
  border-radius:20px;
  box-shadow:0 0 20px rgba(0,0,0,.2);
  display:flex;
  flex-direction:column;
}
#chatLog{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  margin:6px 0;
  padding:8px 12px;
  border-radius:15px;
  max-width:80%;
}
.me{background:#74c0fc;color:white;margin-left:auto;}
.bot{background:#f1f3f5;}
#chatInput{
  border:none;
  border-top:1px solid #ccc;
  padding:10px;
  border-radius:0 0 20px 20px;
}
</style>
</head>

<body>

<h1>ğŸ¨ å°å°æ•°å­—è®¾è®¡å¸ˆ Â· ç”µå­è´ºå¡é—¯å…³</h1>

<div id="content">

<div class="card">
<h2>â‘  è®¤è¯†æ–°æœ‹å‹</h2>
<textarea id="q1" placeholder="æˆ‘è®¤è¯†çš„å·¥å…·æœ‰â€¦â€¦"></textarea>
</div>

<div class="card">
<h2>â‘¡ æˆ‘çš„ç¥ç¦è¯­</h2>
<input id="q2" placeholder="è¯·è¾“å…¥ä½ çš„ç¥ç¦è¯­">
</div>

<div class="card">
<h2>â‘¢ è£…æ‰®æˆ‘çš„è´ºå¡</h2>
<input type="file" multiple accept="image/*" onchange="previewImg(this)">
<div class="preview" id="imgBox"></div>
</div>

<div class="card">
<h2>â‘£ å±•ç¤ºä¸åˆ†äº«</h2>
<textarea id="q3" placeholder="æˆ‘çš„è´ºå¡é€ç»™è°ï¼Ÿæˆ‘æœ€æ»¡æ„å“ªé‡Œï¼Ÿ"></textarea>
</div>

<div class="card">
<h2>ğŸ¤– æˆ‘å’Œæ™ºèƒ½ä½“çš„å­¦ä¹ å¯¹è¯</h2>
<div id="chatRecord"></div>
</div>

</div>

<div style="text-align:center">
<button onclick="saveData()">ğŸ’¾ ä¿å­˜</button>
<button onclick="exportPDF()">ğŸ“„ å¯¼å‡º PDF</button>
</div>

<div id="botBtn" onclick="toggleChat()">ğŸ¤–</div>

<div id="chatBox">
  <div id="chatLog"></div>
  <input id="chatInput" placeholder="å¯ä»¥é—®æˆ‘æ€ä¹ˆåšå“¦ï½" onkeydown="sendChat(event)">
</div>

<script>
const API_KEY="sk-56abaf7300b54705853cba2b1365aeed";
const APP_ID="b02ae061efb14b1fb62db5fc6792bccd";

function toggleChat(){chatBox.style.display=chatBox.style.display==="flex"?"none":"flex";}

async function sendChat(e){
 if(e.key!=="Enter")return;
 const msg=e.target.value;
 chatLog.innerHTML+=`<div class="msg me">${msg}</div>`;
 chatRecord.innerHTML+=`<p>ğŸ‘¦ï¼š${msg}</p>`;
 e.target.value="";
 const res=await fetch(`https://dashscope.aliyuncs.com/api/v1/apps/${APP_ID}/completion`,{
  method:"POST",
  headers:{
    "Authorization":"Bearer "+API_KEY,
    "Content-Type":"application/json"
  },
  body:JSON.stringify({input:{prompt:msg}})
 });
 const data=await res.json();
 const reply=data.output?.text||"æˆ‘æ¥å¸®ä½ æƒ³ä¸€æƒ³ï½";
 chatLog.innerHTML+=`<div class="msg bot">${reply}</div>`;
 chatRecord.innerHTML+=`<p>ğŸ¤–ï¼š${reply}</p>`;
}

function previewImg(input){
 const box=document.getElementById("imgBox");
 box.innerHTML="";
 [...input.files].forEach(f=>{
  const r=new FileReader();
  r.onload=e=>{
    const img=document.createElement("img");
    img.src=e.target.result;
    box.appendChild(img);
  };
  r.readAsDataURL(f);
 });
}

function saveData(){
 const data={
  q1:q1.value,q2:q2.value,q3:q3.value,
  imgs:imgBox.innerHTML,
  chat:chatRecord.innerHTML
 };
 localStorage.setItem("cardData",JSON.stringify(data));
 alert("å·²ä¿å­˜æˆåŠŸï¼");
}

(function load(){
 const d=JSON.parse(localStorage.getItem("cardData")||"{}");
 q1.value=d.q1||"";q2.value=d.q2||"";q3.value=d.q3||"";
 imgBox.innerHTML=d.imgs||"";chatRecord.innerHTML=d.chat||"";
})();

function exportPDF(){
 html2canvas(content).then(c=>{
  const pdf=new jspdf.jsPDF("p","mm","a4");
  pdf.addImage(c.toDataURL(),"PNG",0,0,210,0);
  pdf.save("æˆ‘çš„ç”µå­è´ºå¡.pdf");
 });
}
</script>

</body>
</html>
